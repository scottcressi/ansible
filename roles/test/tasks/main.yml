---
# tasks file for test

- name: create dir
  file:
    path: /tmp/some_directory
    state: directory
    mode: 0755

- name: create file
  copy:
    mode: 0755
    dest: /tmp/some_file_plain
    content: |
      dog1
      tiger

# https://docs.ansible.com/ansible/latest/collections/community/general/hashi_vault_lookup.html#examples
- name: vault secret create
  hashivault_secret:
    secret: somesecretvault
    token: "{{ vault_token }}"
    data:
      somevaultkey: itworked!
      anothervaultkey: itworkedagain!

- name: vault secret check
  ansible.builtin.debug:
    msg: "{{ lookup('community.hashi_vault.hashi_vault',
    'secret=secret/data/somesecretvault
    token={{ vault_token }}
    url=http://{{ vault_server }}:8200'
    ) }}"

- name: vault secret set
  ansible.builtin.set_fact:
    somefactvault: "{{ lookup('community.general.hashi_vault',
    'secret=secret/data/somesecretvault
    token={{ vault_token }}
    url=http://{{ vault_server }}:8200'
    ) }}"

- name: vault secret print
  copy:
    mode: 0755
    dest: /tmp/some_file_vault
    content: |
      {{ somefactvault }}
      {{ somefactvault['somevaultkey'] }}

# https://docs.ansible.com/ansible/latest/collections/amazon/aws/aws_secret_lookup.html
- name: secrets manager secret create
  community.aws.aws_secret:
    name: 'somesecretsecretsmanager'
    state: present
    secret_type: 'string'
    secret: "
            somesecretsmanagerkey
            line2
            "
    region: 'us-east-1'

- name: secrets manager secret check
  debug: msg="{{ lookup('amazon.aws.aws_secret',
         'somesecretsecretsmanager',
         on_denied='warn',
         region='us-east-1')}}"

- name: secrets manager secret set
  ansible.builtin.set_fact:
    somefactsecretsmanager: "{{ lookup('amazon.aws.aws_secret',
    'somesecretsecretsmanager',
    bypath=true,
    region='us-east-1',
    on_denied='warn'
    ) }}"

- name: secrets manager secret print
  copy:
    mode: 0755
    dest: /tmp/some_file_secretsmanager
    content: |
      {{ somefactsecretsmanager }}
      {{ somefactsecretsmanager['somesecretsecretsmanager'] }}

- name: secrets manager secret remove
  community.aws.aws_secret:
    name: 'somesecretsecretsmanager'
    state: absent
    secret_type: 'string'
    secret: "somesecretsecretsmanager"
    region: 'us-east-1'
